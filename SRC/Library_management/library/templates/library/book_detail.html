{% extends "base.html" %}  {# Thay th·∫ø b·∫±ng base template c·ªßa b·∫°n #}

{% block content %}
  <section class="py-16 bg-gradient-to-br from-gray-50 via-gray-100 to-white min-h-screen">
    <div class="container mx-auto px-6 max-w-5xl">
      <a href="{% url 'librarian:managebook' %}" 
        class="group inline-flex items-center text-indigo-600 hover:text-indigo-800 mb-8 font-semibold transition-all duration-300">
        <svg class="w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform duration-300" 
            fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Quay l·∫°i Danh s√°ch s√°ch
      </a>
      <div class="bg-white/80 backdrop-blur-md p-10 rounded-3xl shadow-[0_8px_30px_rgba(0,0,0,0.05)] border border-gray-100 transition hover:shadow-[0_8px_40px_rgba(0,0,0,0.08)] duration-300">
        <header class="mb-8 pb-6 border-b border-gray-200 flex items-start gap-6">
          <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl 
            flex items-center justify-center text-4xl shadow-lg text-white">
            üìñ
          </div>
          <div>
            <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight leading-snug">
              {{ book.title }}
            </h1>
            <p class="text-lg text-gray-600 mt-2 italic">T√°c gi·∫£: 
              <span class="font-semibold text-indigo-700">{{ book.author }}</span>
            </p>
          </div>
        </header>
        <div class="grid md:grid-cols-2 gap-8 mt-8">
  <div class="space-y-4 text-gray-700">
    <h2 class="text-2xl font-bold text-indigo-700 border-b-2 border-indigo-100 pb-2 mb-4">
      üìò Th√¥ng tin c∆° b·∫£n
    </h2>
    <div class="space-y-3">
      <div class="flex justify-between border-b pb-2">
        <span class="font-medium flex items-center space-x-2">üè∑Ô∏è Th·ªÉ lo·∫°i:</span>
        <span class="text-gray-900 font-semibold">{{ book.category }}</span>
      </div>
      <div class="flex justify-between border-b pb-2">
        <span class="font-medium flex items-center space-x-2">üìÖ NƒÉm XB:</span>
        <span class="font-semibold text-gray-900">{{ book.year }}</span>
      </div>
      <div class="flex justify-between border-b pb-2">
        <span class="font-medium flex items-center space-x-2">üì¶ T·ªìn kho:</span>
        <span class="font-extrabold text-2xl 
              {% if book.quantity > 0 %}text-green-600{% else %}text-red-600{% endif %}">
          {{ book.quantity }} cu·ªën
        </span>
      </div>
      <div class="flex justify-between border-b pb-2">
        <span class="font-medium flex items-center space-x-2">üîó M√£ s√°ch:</span>
        <span class="font-semibold text-gray-800">{{ book.book_id }}</span>
      </div>
    </div>
  </div>

              <div>
                <h2 class="text-2xl font-bold text-indigo-600 border-b pb-2 mb-4">M√¥ t·∫£</h2>
                <div class="text-gray-700 leading-relaxed max-h-64 overflow-y-auto bg-gray-50 rounded-lg shadow-inner px-3 py-2 mt-2">
                    {{ book.description|default:"S√°ch n√†y hi·ªán ch∆∞a c√≥ m√¥ t·∫£ chi ti·∫øt."|striptags|linebreaksbr }}

                </div>
            </div>
</div>

<div class="mt-10 text-right">
  <button
    onclick="openBorrowModal('{{ book.book_id }}', '{{ book.title }}', '{{ book.author }}')"
    class="relative bg-gradient-to-r from-amber-500 to-orange-600 text-white px-8 py-3 rounded-xl 
           font-semibold shadow-md hover:shadow-lg hover:scale-105 transition-all duration-300"
    {% if book.quantity == 0 %}disabled{% endif %}
  >
    <span class="relative z-10">üìö M∆∞·ª£n S√°ch Ngay</span>
    <div class="absolute inset-0 rounded-xl opacity-0 hover:opacity-100 transition bg-gradient-to-r from-orange-400 to-yellow-500 blur-lg"></div>
  </button>
</div>

        </div>
        
        {# ================================================================= #}
        {#                   PH·∫¶N ƒê√ÅNH GI√Å V√Ä B√åNH LU·∫¨N                      #}
        {# ================================================================= #}
        <div class="mt-12 bg-white p-8 rounded-2xl shadow-2xl border-t-4 border-yellow-500">
            <h2 class="text-3xl font-extrabold text-gray-900 border-b-2 border-yellow-100 pb-3 mb-6 flex items-center space-x-3">
                <span>‚≠êÔ∏è ƒê√°nh Gi√° Chung: </span>
                <span class="text-yellow-600">
                    {% if avg_rating %}{{ avg_rating|floatformat:1 }} / 5.0{% else %}Ch∆∞a c√≥{% endif %}
                </span>
                <span class="text-gray-500 text-base">({{ reviews|length }} l∆∞·ª£t ƒë√°nh gi√°)</span>
            </h2>
            
            <div class="bg-yellow-50 p-6 rounded-xl shadow-inner mb-8">
                <h3 class="text-xl font-bold text-yellow-700 mb-4">
                    {% if user_review %}S·ª≠a ƒê√°nh Gi√° C·ªßa B·∫°n{% else %}G·ª≠i ƒê√°nh Gi√°{% endif %}
                </h3>

                {% if request.user.is_authenticated %}
                    <form method="POST" class="space-y-4">
                        {% csrf_token %}
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">S·ªë Sao:</label>
                            <select name="rating" required class="w-full md:w-1/2 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-yellow-500 focus:border-yellow-500">
                                {% for value, label in book.reviews.first.RATING_CHOICES|default:'' %}
                                    <option value="{{ value }}" 
                                        {% if user_review and user_review.rating == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% empty %}
                                    <option value="5" {% if user_review.rating == 5 %}selected{% endif %}>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                                    <option value="4" {% if user_review.rating == 4 %}selected{% endif %}>‚≠ê‚≠ê‚≠ê‚≠ê</option>
                                    <option value="3" {% if user_review.rating == 3 %}selected{% endif %}>‚≠ê‚≠ê‚≠ê</option>
                                    <option value="2" {% if user_review.rating == 2 %}selected{% endif %}>‚≠ê‚≠ê</option>
                                    <option value="1" {% if user_review.rating == 1 %}selected{% endif %}>‚≠ê</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div>
                            <label for="comment" class="block text-sm font-medium text-gray-700">B√¨nh lu·∫≠n:</label>
                            <textarea 
                                name="comment" 
                                id="comment" 
                                rows="4" 
                                class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-yellow-500 focus:border-yellow-500 p-3"
                            >{{ user_review.comment|default:"" }}</textarea>
                        </div>

                        <button type="submit" class="bg-yellow-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-yellow-700 transition duration-200 shadow-md">
                            {% if user_review %}C·∫≠p Nh·∫≠t ƒê√°nh Gi√°{% else %}G·ª≠i ƒê√°nh Gi√°{% endif %}
                        </button>
                    </form>
                {% else %}
                    <p class="text-lg text-red-600">
                        Vui l√≤ng <a href="{% url 'account:login' %}" class="font-bold underline">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ g·ª≠i ƒë√°nh gi√°.
                    </p>
                {% endif %}
            </div>

            <h3 class="text-2xl font-bold text-gray-800 mb-4">
                C√°c ƒë√°nh gi√° kh√°c
            </h3>
            
            <div class="space-y-6">
                {% for review in reviews %}
                    <div class="border border-gray-200 p-5 rounded-xl shadow-md bg-white hover:shadow-lg transition-shadow">
                        <div class="flex justify-between items-center mb-2">
                            <p class="font-bold text-lg text-gray-900">
                                üë§ {{ review.user.username }} 
                                {% if review.user == request.user %}
                                    <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full ml-2">B·∫°n</span>
                                {% endif %}
                            </p>
                            <div class="text-yellow-500 font-extrabold text-xl">
                                {{ review.get_rating_display }} 
                            </div>
                        </div>
                        <p class="text-gray-700 italic border-l-4 border-gray-200 pl-3">
                            "{{ review.comment|default:"‚Äî Kh√¥ng c√≥ b√¨nh lu·∫≠n ‚Äî" }}"
                        </p>
                        <p class="text-xs text-gray-500 mt-2 text-right">
                            Ng√†y: {{ review.created_at|date:"d/m/Y H:i" }}
                        </p>
                    </div>
                {% empty %}
                <p class="text-gray-500 italic py-5 text-center border-dashed border-2 border-gray-300 rounded-lg">
                    Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho cu·ªën s√°ch n√†y. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!
                </p>
                {% endfor %}
            </div>
        </div>
        
    </div>
</section>
<div
  id="borrowModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50"
>
  <div class="bg-white rounded-2xl p-6 w-[400px] shadow-2xl">
    <h2 class="text-2xl font-bold text-center mb-4 text-orange-600">
      M∆∞·ª£n s√°ch üìö
    </h2>

    <!-- Th√¥ng tin s√°ch -->
    <div class="mb-4">
      <p id="bookTitle" class="font-semibold text-lg">T√™n s√°ch</p>
      <p id="bookAuthor" class="text-gray-600">T√°c gi·∫£</p>
    </div>

    <!-- Form ch·ªçn ng√†y v√† s·ªë l∆∞·ª£ng -->
    <form id="borrowForm" class="space-y-3">
      {% csrf_token %}
      <div>
        <label class="block font-medium">Ng√†y m∆∞·ª£n:</label>
        <input
          type="date"
          id="borrowDate"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
          required
        />
      </div>

      <div>
        <label class="block font-medium">Ng√†y tr·∫£:</label>
        <input
          type="date"
          id="returnDate"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-400"
          required
        />
      </div>

      <div>
        <label for="quantity" class="block text-gray-700 font-semibold">S·ªë l∆∞·ª£ng:</label>
        <input 
            type="number" 
            id="quantity" 
            name="quantity" 
            value="1" 
            readonly
            class="w-full px-3 py-2 border rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed"
        >
      </div>

      <div class="flex justify-end space-x-3 mt-4">
        <button
          type="button"
          onclick="closeBorrowModal()"
          class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg"
        >
          H·ªßy
        </button>
        <button
          type="submit"
          class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all"
        >
          X√°c nh·∫≠n
        </button>
      </div>
    </form>
  </div>
</div>


<!-- Th√™m th∆∞ vi·ªán SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  let selectedBookId = null;

  function openBorrowModal(id, title, author) {
    selectedBookId = id;
    document.getElementById("bookTitle").textContent = `T√™n s√°ch: ${title}`;
    document.getElementById("bookAuthor").textContent = `T√°c gi·∫£: ${author}`;
    
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    const todayStr = `${yyyy}-${mm}-${dd}`;

    // G√°n gi√° tr·ªã m·∫∑c ƒë·ªãnh cho ng√†y m∆∞·ª£n (h√¥m nay)
    const borrowDateInput = document.getElementById("borrowDate");
    borrowDateInput.value = todayStr;
    borrowDateInput.min = todayStr;

    // Ng√†y tr·∫£ (t·ªëi thi·ªÉu l√† ng√†y mai)
    const returnDateInput = document.getElementById("returnDate");
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    const tomorrowStr = `${yyyy}-${mm}-${String(tomorrow.getDate()).padStart(2, "0")}`;
    returnDateInput.min = tomorrowStr;
    returnDateInput.value = tomorrowStr;

    document.getElementById("borrowModal").classList.remove("hidden");
  }

  function closeBorrowModal() {
    document.getElementById("borrowModal").classList.add("hidden");
  }

  document.getElementById("borrowForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const borrowDate = document.getElementById("borrowDate").value;
    const returnDate = document.getElementById("returnDate").value;
    const quantity = document.getElementById("quantity").value;
    
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    try {
      const response = await fetch("/library/borrow/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken,
        },
        body: JSON.stringify({
          book_id: selectedBookId,
          borrow_date: borrowDate,
          return_date: returnDate,
          quantity: quantity,
        }),
      });

      const data = await response.json();

      if (data.success) {
        Swal.fire({
          icon: "success",
          title: "M∆∞·ª£n s√°ch th√†nh c√¥ng!",
          text: "H·ªá th·ªëng ƒë√£ ghi nh·∫≠n y√™u c·∫ßu c·ªßa b·∫°n.",
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true
        }).then(() => {
          closeBorrowModal();
          window.location.reload();
        });
      } else {
        Swal.fire({
          icon: "error",
          title: "L·ªói!",
          text: data.message || "Kh√¥ng th·ªÉ m∆∞·ª£n s√°ch, vui l√≤ng th·ª≠ l·∫°i.",
          confirmButtonColor: "#d33",
        });
      }
    } catch (error) {
      Swal.fire({
        icon: "error",
        title: "L·ªói k·∫øt n·ªëi!",
        text: "Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i sau.",
        confirmButtonColor: "#d33",
      });
    }
  });
</script>


    <script>
        // Extended book data


        let currentPage = 1;
        let itemsPerPage = 12;
        let currentView = 'grid';

        // Display books
        function displayBooks(booksToShow, page = 1) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedBooks = booksToShow.slice(startIndex, endIndex);
            
            const grid = document.getElementById('booksGrid');
            
            if (currentView === 'grid') {
                grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8';
                grid.innerHTML = paginatedBooks.map(book => `
                    <div class="book-card bg-white rounded-xl shadow-md overflow-hidden transition-transform duration-300 hover:shadow-lg">
                        <div class="h-48 bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center">
                            <span class="text-white text-4xl">üìö</span>
                        </div>
                        <div class="p-6">
                            <h4 class="font-semibold text-lg mb-2 text-gray-900">${book.title}</h4>
                            <p class="text-gray-600 mb-1">T√°c gi·∫£: ${book.author}</p>
                            <p class="text-gray-500 text-sm mb-3">NƒÉm xu·∫•t b·∫£n: ${book.year}</p>
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-1">
                                    <span class="text-yellow-400">‚≠ê</span>
                                    <span class="text-sm text-gray-600">${book.rating}</span>
                                </div>
                                <span class="px-3 py-1 text-xs rounded-full ${book.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${book.available ? 'C√≥ s·∫µn' : 'ƒê√£ m∆∞·ª£n'}
                                </span>
                            </div>
                            <button onclick="borrowBook(${book.id})" 
                                    class="w-full py-2 px-4 rounded-lg transition-colors ${book.available ? 'bg-indigo-600 hover:bg-indigo-700 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}"
                                    ${!book.available ? 'disabled' : ''}>
                                ${book.available ? 'M∆∞·ª£n s√°ch' : 'Kh√¥ng c√≥ s·∫µn'}
                            </button>
                        </div>
                    </div>
                `).join('');
            } else {
                grid.className = 'space-y-4 mb-8';
                grid.innerHTML = paginatedBooks.map(book => `
                    <div class="book-card bg-white rounded-xl shadow-md p-6 transition-transform duration-300 hover:shadow-lg">
                        <div class="flex items-center space-x-6">
                            <div class="w-20 h-28 bg-gradient-to-br from-indigo-400 to-purple-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                <span class="text-white text-2xl">üìö</span>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-xl mb-2 text-gray-900">${book.title}</h4>
                                <p class="text-gray-600 mb-1">T√°c gi·∫£: ${book.author}</p>
                                <p class="text-gray-500 text-sm mb-2">NƒÉm xu·∫•t b·∫£n: ${book.year}</p>
                                <div class="flex items-center space-x-4 mb-3">
                                    <div class="flex items-center space-x-1">
                                        <span class="text-yellow-400">‚≠ê</span>
                                        <span class="text-sm text-gray-600">${book.rating}</span>
                                    </div>
                                    <span class="px-3 py-1 text-xs rounded-full ${book.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${book.available ? 'C√≥ s·∫µn' : 'ƒê√£ m∆∞·ª£n'}
                                    </span>
                                </div>
                            </div>
                            <div class="flex-shrink-0">
                                <button onclick="borrowBook(${book.id})" 
                                        class="py-2 px-6 rounded-lg transition-colors ${book.available ? 'bg-indigo-600 hover:bg-indigo-700 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}"
                                        ${!book.available ? 'disabled' : ''}>
                                    ${book.available ? 'M∆∞·ª£n s√°ch' : 'Kh√¥ng c√≥ s·∫µn'}
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            updateResultsCount(booksToShow.length);
            updatePagination(booksToShow.length);
        }

        // Filter books by category
        function filterBooks(category) {
            currentBooks = category === 'all' ? [...books] : books.filter(book => book.category === category);
            currentPage = 1;
            displayBooks(currentBooks, currentPage);
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-indigo-600', 'text-white');
        }

        // Advanced search
        function performSearch() {
            const titleSearch = document.getElementById('searchTitle').value.toLowerCase();
            const authorSearch = document.getElementById('searchAuthor').value.toLowerCase();
            const sortBy = document.getElementById('sortBy').value;
            
            let filteredBooks = books.filter(book => {
                const titleMatch = !titleSearch || book.title.toLowerCase().includes(titleSearch);
                const authorMatch = !authorSearch || book.author.toLowerCase().includes(authorSearch);
                return titleMatch && authorMatch;
            });
            
            // Sort books
            filteredBooks.sort((a, b) => {
                switch(sortBy) {
                    case 'author':
                        return a.author.localeCompare(b.author);
                    case 'rating':
                        return b.rating - a.rating;
                    case 'year':
                        return b.year - a.year;
                    default:
                        return a.title.localeCompare(b.title);
                }
            });
            
            currentBooks = filteredBooks;
            currentPage = 1;
            displayBooks(currentBooks, currentPage);
        }

        // Toggle view
        function toggleView(view) {
            currentView = view;
            document.getElementById('gridView').classList.toggle('bg-indigo-600', view === 'grid');
            document.getElementById('gridView').classList.toggle('text-white', view === 'grid');
            document.getElementById('gridView').classList.toggle('bg-gray-200', view !== 'grid');
            document.getElementById('gridView').classList.toggle('text-gray-600', view !== 'grid');
            
            document.getElementById('listView').classList.toggle('bg-indigo-600', view === 'list');
            document.getElementById('listView').classList.toggle('text-white', view === 'list');
            document.getElementById('listView').classList.toggle('bg-gray-200', view !== 'list');
            document.getElementById('listView').classList.toggle('text-gray-600', view !== 'list');
            
            displayBooks(currentBooks, currentPage);
        }

        // Update items per page
        function updateItemsPerPage() {
            itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            currentPage = 1;
            displayBooks(currentBooks, currentPage);
        }

        // Update results count
        function updateResultsCount(total) {
            const start = (currentPage - 1) * itemsPerPage + 1;
            const end = Math.min(currentPage * itemsPerPage, total);
            document.getElementById('resultsCount').textContent = `Hi·ªÉn th·ªã ${start}-${end} trong t·ªïng s·ªë ${total} cu·ªën s√°ch`;
        }

        // Update pagination
        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            pagination.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = `px-4 py-2 rounded-lg transition-colors ${i === currentPage ? 'bg-indigo-600 text-white' : 'bg-white border border-gray-300 hover:bg-gray-50'}`;
                button.onclick = () => {
                    currentPage = i;
                    displayBooks(currentBooks, currentPage);
                };
                pagination.appendChild(button);
            }
        }

        // Change page
        function changePage(direction) {
            const totalPages = Math.ceil(currentBooks.length / itemsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                displayBooks(currentBooks, currentPage);
            }
        }
         function filterBooks(category) {
          const bookItems = document.querySelectorAll(".book-item");
          const filterButtons = document.querySelectorAll(".filter-btn");

          // Reset tr·∫°ng th√°i n√∫t
          filterButtons.forEach((btn) => {
            btn.classList.remove(
              "bg-gradient-to-r",
              "from-blue-500",
              "to-purple-600",
              "text-white"
            );
            btn.classList.add(
              "bg-white",
              "text-gray-700",
              "border",
              "border-gray-200"
            );
          });

          // Active n√∫t v·ª´a click
          const activeButton = Array.from(filterButtons).find((btn) =>
            btn.getAttribute("onclick")?.includes(category)
          );
          if (activeButton) {
            activeButton.classList.remove(
              "bg-white",
              "text-gray-700",
              "border",
              "border-gray-200"
            );
            activeButton.classList.add(
              "bg-gradient-to-r",
              "from-blue-500",
              "to-purple-600",
              "text-white"
            );
          }

          // L·ªçc s√°ch
          let visibleCount = 0;
          bookItems.forEach((item, index) => {
            if (category === "all" || item.dataset.category === category) {
              item.style.display = "block";
              item.style.animationDelay = `${index * 0.1}s`;
              visibleCount++;
            } else {
              item.style.display = "none";
            }
          });

          // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
          document.getElementById("bookCount").textContent = visibleCount;
        }

        function showBorrowTab(tabName, buttonElement) {
          // ·∫®n t·∫•t c·∫£ borrow content
          document.querySelectorAll(".borrow-content").forEach((content) => {
            content.classList.add("hidden");
          });

          // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
          document.getElementById(tabName).classList.remove("hidden");
          document.getElementById(tabName).classList.add("fade-in");

          // C·∫≠p nh·∫≠t active state cho borrow tab buttons
          document.querySelectorAll(".borrow-tab").forEach((btn) => {
            btn.classList.remove("bg-green-500", "text-white");
            btn.classList.add("text-gray-600");
          });

          // Th√™m active state cho button ƒë∆∞·ª£c click
          if (buttonElement) {
            buttonElement.classList.remove("text-gray-600");
            buttonElement.classList.add("bg-green-500", "text-white");
          }
        }
        window.onload = function () {
          const params = new URLSearchParams(window.location.search);
          const section = params.get("section") || "quanLySach"; // m·∫∑c ƒë·ªãnh m·ªü qu·∫£n l√Ω s√°ch

          // T√¨m ƒë√∫ng n√∫t t∆∞∆°ng ·ª©ng (d√πng nav-item, kh√¥ng ph·∫£i nav-btn)
          const button = document.querySelector(
            `.nav-item[onclick*="${section}"]`
          );

          // G·ªçi showSection ƒë·ªÉ hi·ªÉn th·ªã
          if (button) {
            showSection(section, button);
          } else {
            // fallback n·∫øu kh√¥ng c√≥ button (tr√°nh l·ªói)
          }
        };

        // Borrow book function
        function borrowBook(bookId) {
            const book = books.find(b => b.id === bookId);
            if (book && book.available) {
                alert(`B·∫°n ƒë√£ m∆∞·ª£n th√†nh c√¥ng cu·ªën s√°ch "${book.title}". Vui l√≤ng ƒë·∫øn qu·∫ßy th·ªß th∆∞ ƒë·ªÉ ho√†n t·∫•t th·ªß t·ª•c.`);
                book.available = false;
                displayBooks(currentBooks, currentPage);
            }
        }

        //
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e6d15c33c1b451',t:'MTc1Nzc1NzgzOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
{% endblock %}
